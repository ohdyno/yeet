#!/usr/bin/env python3
"""Single-file launcher for the Yeet Player CLI."""

from __future__ import annotations

import os
import sys
from pathlib import Path


def _bootstrap() -> None:
    root = Path(__file__).resolve().parent
    _ensure_venv(root)
    src = root / "src"
    if src.exists():
        sys.path.insert(0, str(src))


def _ensure_venv(root: Path) -> None:
    """Re-exec inside the project's virtualenv if available."""

    venv_path = root / ".venv"
    if not venv_path.exists():
        return

    inside = Path(sys.prefix).resolve() == venv_path.resolve()
    if inside:
        return

    python_bin = venv_path / ("Scripts" if os.name == "nt" else "bin") / "python3"
    if not python_bin.exists():
        # Fallback to 'python'
        python_bin = venv_path / ("Scripts" if os.name == "nt" else "bin") / "python"

    if python_bin.exists():
        os.execv(str(python_bin), [str(python_bin), str(Path(__file__).resolve()), *sys.argv[1:]])


def main() -> None:
    _bootstrap()

    from yeet_player.cli import main as cli_main

    cli_main()


if __name__ == "__main__":
    main()
